!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.ChCalendar.Double=e()}(this,function(){"use strict";var t,e,n={},a=require("../ChCalendar");t={init:function(t){var e=this.createHeader(),n=this.createContent(t),a=this.createBottom();return $("<div class='ChDatePicker_con'>"+e+n+a+"</div>")},createHeader:function(){return""},createContent:function(t){for(var e='<div class="ChDatePicker_con_calendar">',n=0;n<t.number;n++)e+="<div class='ChDatePicker_con_calendar_list'></div>";return e+="</div>"},createBottom:function(){return'<div class="ChDatePicker_con_operation"><a class="ChDatePicker_confirm" data-type="confirm" href="javascript:;">确定</a><a class="ChDatePicker_cancel" data-type="cancel" href="javascript:;">取消</a></div>'}},e={init:function(t){var e=$.extend(!0,{},t),n=e.$target.parent();this.setInputVal(e),e.$target.remove();var a=$("<div class='ChDatePicker'></div>").append(e.$target),r=this;n.append(a),t.$html=e.$html=a,e.$target.on("focus",function(){e.calendarList||(r.reloadCalendar(e),r.eventBind(e,t))}),r.watchEvent(e,t),a.on("click",function(t){t.stopPropagation(),t.preventDefault()})},setInputVal:function(t){t.$target.val(a.util.formatDate(t.o.date.start,"yyyy/mm/dd")+"-"+a.util.formatDate(t.o.date.end,"yyyy/mm/dd"))},reloadCalendar:function(e,n){var r=e.childCalendar.number;e.domConfig={number:r};var c=t.init(e.domConfig),i=[],o=this,l=c.find(".ChDatePicker_con_calendar_list");e.$target.after(c),c.on("click",function(t){t.stopPropagation(),t.preventDefault()}),$(document).on("click.Double",function(){o.close(e),$(document).off("click.Double")}),l.each(function(t){var n=$.extend(!0,{},e.o,e.childCalendar[t]),r=n.currentDate||n.date.start;r=a.util.formatDate(r,"yyyy/mm/dd"),n.currentDate=n.currentDate||a.util.calculationMonth(r,t),i.push(new a($(this),$.extend(!0,{},n)))}),e.calendarList=i},watchEvent:function(t,e){var n=this;$(e).on("setDate",function(e,a){t.o.date=a.date?a.date:t.o.date,n.setInputVal(t)})},eventBind:function(t,e){var n=this;t.calendarList.forEach(function(e,n){$(e).on("pre",function(e,r){t.calendarList.forEach(function(t,e,c){n!=e&&(n<e?t.setCurrentPanels({currentDate:a.util.formatDate(a.util.calculationMonth(r.currentDate,1),"yyyy/mm/dd")}):t.setCurrentPanels({currentDate:a.util.formatDate(a.util.calculationMonth(r.currentDate,-1),"yyyy/mm/dd")}))})}),$(e).on("next",function(e,r){t.calendarList.forEach(function(t,e,c){n!=e&&(n<e?t.setCurrentPanels({currentDate:a.util.formatDate(a.util.calculationMonth(r.currentDate,1),"yyyy/mm/dd")}):t.setCurrentPanels({currentDate:a.util.formatDate(a.util.calculationMonth(r.currentDate,-1),"yyyy/mm/dd")}))})}),$(e).on("changeDay",function(e,a){var r=this.o.date;t.calendarList.forEach(function(t,e,a){n!=e&&t.setDates({start:r.start,end:r.end})})}),$(e).on("changeMonth",function(e,r){t.calendarList.forEach(function(t,e,c){n!=e&&(n<e?t.setCurrentPanels({currentDate:a.util.formatDate(a.util.calculationMonth(r,1),"yyyy/mm/dd")}):t.setCurrentPanels({currentDate:a.util.formatDate(a.util.calculationMonth(r,-1),"yyyy/mm/dd")}))})})}),t.$html.find(".ChDatePicker_confirm").on("click",function(){n.confirm(t,e)}),t.$html.find(".ChDatePicker_cancel").on("click",function(){n.cancel(t,e)})},close:function(t){t.$html.find(".ChDatePicker_con").remove(),t.calendarList.forEach(function(t,e){t.dispose(),t=null}),t.calendarList=null},confirm:function(t,e){e.o.date=t.o.date=$.extend(!0,{},t.calendarList[0].o.date),this.setInputVal(t),this.close(t),$(e).trigger("confirm")},cancel:function(t,e){this.close(t),$(e).trigger("cancel")}};var r=function(t,a){var r=$.extend(!0,{},n,a);this.childCalendar=r.calendar,r.calendar=null,this.o=r,this.$target=$(t),e.init(this)};return r.prototype={setDates:function(t,e){var n={start:a.util.formatDate(t.start,"yyyy/mm/dd"),end:a.util.formatDate(t.end,"yyyy/mm/dd")};$(this).trigger("setDate",[{date:n,callback:e}])}},r});